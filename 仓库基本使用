https://help.aliyun.com/document_detail/60763.html


###########

仓库基本使用
更新时间：2017-10-26 22:01:33

  
仓库的最佳实践
仓库作为一些镜像的集合，推荐将一个应用或功能不同版本的镜像放置在一个仓库中。
以软件包作为仓库名称：centos、jetty
以应用名作为仓库名称：console-web、console-service
仓库的主要功能
仓库可见性设置
设置为公有仓库，仓库是开放的，允许所有用户匿名下载。
设置为私有仓库，仓库是其他用户不可见的，只有有权限的账户登录才能进行下载。
镜像部署
在仓库单击部署按钮，可以直接前往容器服务进行部署。
仓库镜像查询
列举仓库内的镜像，并获得镜像的Digest和ImageId。
检查镜像的层信息，查看镜像的每一层大小和每一层的构建元信息。
镜像安全扫描功能，对镜像中存在的漏洞进行扫描，并对部分楼栋号提供解决方案。
Webhook
提供仓库镜像的消息触发功能，当镜像上传之后主动触发用户设置的访问地址。
串联镜像服务的下游流程。
仓库授权
将仓库的权限分发给子账户，子账户需要先登录控制台设置密码。
READ: 只读权限，只能拉取镜像。
WRITE: 可写权限，可以推送镜像。
ADMIN：管理员权限，可以对仓库做管理操作。
镜像构建服务
管理用户的源代码仓库，当代码提交后按照用户设置的构建规则进行镜像构建，并推动到用户仓库。
串联镜像服务的上游流程



@@@@@@


仓库构建
更新时间：2017-10-26 22:01:33

  
简述
阿里云容器镜像构建完全遵循开源容器技术标准，提供基于dockerfile的构建功能，打通用户代码仓库到容器应用部署整个环节，方便用户快捷高效地容器化自己的服务。

特点功能
支持代码变更时自动触发构建

通过设置代码变更时自动构建镜像，可以激活在代码提交后自动触发镜像构建的特性，以减少每次代码提交后手动触发构建的繁琐工作。doc_1.png

支持海外构建

代码构建过程中可能会依赖国外源，但由于网络环境，我们提供海外构建功能，在海外构建完成后，将镜像推回到指定region的仓库中。doc_2.png

支持多阶段构建

阿里云容器镜像构建同时支持最新的多阶段构建特性。

设置构建规则
登录容器镜像服务控制台。
单击右侧导航栏中的创建镜像仓库。

doc_4.png

设置构建规则。

doc_3.png

代码变更时自动构建镜像：勾选后，当分支有代码提交后会自动触发构建规则。
海外机器构建：勾选后，构建时会在海外机房构建，构建成功后推回指定region。注意：由于有时海外回大陆网络不稳定可能会导致镜像推回超时失败的情况。
不使用缓存：勾选后，每次构建时会强制重新拉取基础依赖镜像，可能会减慢构建时间。
选择Branch或Tag：设置构建的代码分支。
Dockerfile目录：设置Dockerfile文件所在的目录。注意：这里的目录指的是相对目录，以代码分支的根目录为父目录。
Dockerfile文件名：设置Dockerfile文件名，默认为Dockerfile。
镜像版本：设置镜像Tag，比如latest。
单击右下角的创建镜像仓库，则镜像仓库创建完成。

修改构建规则
登录容器镜像服务控制台。

单击右侧操作列表中的管理，进入到仓库详情界面。

doc_5.png

单击左侧导航栏中的构建，进入到镜像构建详情页面。

doc_6.png

单击右侧修改设置，开始修改构建规则。

doc_7.png

修改设置构建规则。

doc_8.png

代码变更时自动构建镜像：勾选后，当分支有代码提交后会自动触发构建规则。
海外机器构建：勾选后，构建时会在海外机房构建，构建成功后推回指定region。注意：由于有时海外回大陆网络不稳定可能会导致镜像推回超时失败的情况。
不使用缓存：勾选后，每次构建时会强制重新拉取基础依赖镜像，可能会减慢构建时间。
添加一条构建规则：新建一条构建规则。
㊀：删除本条构建规则。
单击确定则构建规则修改完成。

构建镜像
登录容器镜像服务控制台。

选择所需的地域。

选择所需的镜像仓库并单击右侧的管理，进入到指定仓库的构建详情界面。

单击左侧导航栏中的构建。

单击右上角立即构建，则依据已设置的构建规则开始构建镜像。

doc_9.png

单击立即构建后，生成新的构建记录。

doc_10.png

单击右侧操作列表的日志按钮，查看构建日志记录。

doc_11.png

等待镜像构建完成后，单击左侧菜单栏中的镜像版本，查看已构建完成的镜像列表。

doc_12.png

查看所有镜像版本列表。

